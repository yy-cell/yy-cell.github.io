{"title":"","slug":"配置路由重分布和路由映射表：","date":"2019-08-20T09:30:11.108Z","updated":"2019-08-20T09:30:11.297Z","comments":true,"path":"api/articles/配置路由重分布和路由映射表：.json","photos":[],"link":"","excerpt":null,"covers":["https://s2.ax1x.com/2019/08/20/mJT44f.png","https://s2.ax1x.com/2019/08/20/mJ7raq.png","https://s2.ax1x.com/2019/08/20/mJ76iV.png"],"content":"<hr>\n<h2 id=\"路由重分布与路由映射表\"><a href=\"#路由重分布与路由映射表\" class=\"headerlink\" title=\"路由重分布与路由映射表\"></a>路由重分布与路由映射表</h2><p>路由重分布：<br>给rip设置metric值为3，如果不设置，默认为不可达，就通不了其他的协议<br>R1(config)#router rip<br>R1(config-router)#re<br>R1(config-router)#redistribute sta<br>R1(config-router)#redistribute static me<br>R1(config-router)#redistribute static metric 3<br>给R2配置两个不同协议互通<br>R2(config)#router rip<br>R2(config-router)#redistribute eigrp 1<br>R2(config-router)#default-metric 4<br>R2(config)#router eigrp 1<br>R2(config-router)#redistribute rip metric 1000 100 255 1 1500<br>给R3配置不同协议互通：<br>R3(config)#router eigrp 1<br>R3(config-router)#redistribute rip metric 1000 100 255 1 1500<br>R3(config-router)#distance eigrp 90 150（配置eigrp的默认管理距离，内部90，外部150）</p>\n<p>R3(config)#router ospf 1<br>R3(config-router)#redistribute eigrp 1 metric-type 1 subnets<br>R3(config-router)#redistribute maximum-prefix 100 50（100表示最大条目为100 ，50是表示超过最大路由条目的百分之50开始提示，warning-only表示只是提示，并不会限制充分的路由条目）</p>\n<p>策略路由：<br>一、基于源地址的策略路由配置：</p>\n<p><img src=\"https://s2.ax1x.com/2019/08/20/mJT44f.png\" alt></p>\n<p>配置ACL（配置两条规则）<br>R1(config)#access-list 1 permit 172.16.1.2<br>R1(config)#access-list 2 permit 172.16.1.3<br>配置路由映射表<br>R1(config)#route-map CCNA permit 10             （路由映射表名  10）<br>R1(config-route-map)#match ip address 1         （执行1这个规则）<br>R1(config-route-map)#set ip next-hop 172.16.12.2（设定下一跳端口ip）<br>R1(config-route-map)#exit<br>R1(config)#route-map CCNA permit 20<br>R1(config-route-map)#match ip address 2<br>R1(config-route-map)#set ip next-hop 172.16.21.2<br>应用策略路由<br>R1(config)#int f0/0<br>R1(config-if)#ip policy route-map CCNA<br>实验调试：<br>1、查看路由路径(路由追踪)<br>PC2#traceroute 172.16.2.2<br>PC3#traceroute 172.16.2.2<br>2、在R1上显示调试信息<br>R1#debug ip policy<br>PC2：ping 172.16.2.2<br>PC6:ping 172.16.2.2<br>3、显示在哪些接口上应用了策略路由<br>R1#sh ip policy</p>\n<p>二、基于数据包长度的策略路由配置：</p>\n<p><img src=\"https://s2.ax1x.com/2019/08/20/mJ7raq.png\" alt></p>\n<p>配置路由映射表<br>R1(config)#route-map CCNP permit 10<br>R1(config-route-map)#match length 64 100   （设置64-100字节的数据包限制）<br>R1(config-route-map)#set interface s1/0     （指定接口传输数据包）<br>R1(config)#route-map CCNP permit 20<br>R1(config-route-map)#match length 101 1000    （设置101-1000字节数据包）<br>R1(config-route-map)#set interface f0/1          （指定接口）<br>应用策略路由<br>R1(config)#int f0/0<br>R1(config-if)#ip policy route-map CCNP<br>R1(config-if)#exit<br>R1(config)#ip local policy route-map CCNP<br>显示定义的所有路由策略及路由策略匹配的情况<br>R1#sh ip route-map CCNP</p>\n<p>三、基于应用的策略路由配置</p>\n<p><img src=\"https://s2.ax1x.com/2019/08/20/mJ76iV.png\" alt></p>\n<p>配置R2的http与telnet访问<br>R2(config)#ip http server<br>R2(config)#line vty 0 4<br>R2(config-line)#no login<br>R2(config-line)#privilege level 15   （设置优先级）<br>配置扩展ACL<br>R1(config)#ip access-list extended HTTP<br>R1(config-ext-nacl)#permit tcp any any eq 80<br>R1(config-ext-nacl)#exit<br>R1(config)#ip access-list extended TELNET<br>R1(config-ext-nacl)#permit tcp any any eq 23<br>配置路由映射表<br>R1(config)#route-map CCIE permit 10<br>R1(config-route-map)#match ip address HTTP<br>R1(config-route-map)#set ip precedence flash<br>R1(config-route-map)#set ip next-hop 172.16.12.2<br>R1(config)#route-map CCIE permit 20<br>R1(config-route-map)#match ip address TELNET<br>R1(config-route-map)#set ip precedence critical<br>R1(config-route-map)#set ip next-hop 172.16.21.2<br>应用路由映射表<br>R1(config)#int f0/0<br>R1(config-if)#ip policy route-map CCIE<br>R1(config)#ip local policy route-map CCIE</p>\n","categories":[],"tags":[]}